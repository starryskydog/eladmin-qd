(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0d40"],{"1B/D":function(e,t,i){"use strict";var o=i("dc33");i.n(o).a},Yfch:function(e,t,i){"use strict";function o(e){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(e)}i.d(t,"a",function(){return o})},dc33:function(e,t,i){},q4Ke:function(e,t,i){"use strict";i.r(t);var o=i("Q2AE"),a=i("Yfch"),s=i("wk8/"),r=i("t3Un");var n={props:{email:{type:String,required:!0}},data:function(){var e=this;return{loading:!1,dialog:!1,title:"修改邮箱",form:{pass:"",email:"",code:""},user:{email:"",password:""},codeLoading:!1,codeData:{type:"email",value:""},buttonName:"获取验证码",isDisabled:!1,time:60,rules:{pass:[{required:!0,message:"当前密码不能为空",trigger:"blur"}],email:[{required:!0,validator:function(t,i,o){""===i||null===i?o(new Error("新邮箱不能为空")):i===e.email?o(new Error("新邮箱不能与旧邮箱相同")):Object(a.a)(i)?o():o(new Error("邮箱格式错误"))},trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},sendCode:function(){var e=this;if(this.form.email&&this.form.email!==this.email){this.codeLoading=!0,this.buttonName="验证码发送中",this.codeData.value=this.form.email;var t=this;(function(e){return Object(r.a)({url:"api/code/resetEmail",method:"post",data:e})})(this.codeData).then(function(i){e.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"}),e.codeLoading=!1,e.isDisabled=!0,e.buttonName=e.time--+"秒后重新发送",e.timer=window.setInterval(function(){t.buttonName=t.time+"秒后重新发送",--t.time,t.time<0&&(t.buttonName="重新发送",t.time=60,t.isDisabled=!1,window.clearInterval(t.timer))},1e3)}).catch(function(t){e.resetForm(),e.codeLoading=!1,console.log(t.response.data.message)})}},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,e.user={email:e.form.email,password:e.form.pass},Object(s.d)(e.form.code,e.user).then(function(t){e.loading=!1,e.resetForm(),e.$notify({title:"邮箱修改成功",type:"success",duration:1500}),o.a.dispatch("GetInfo").then(function(){})}).catch(function(t){e.loading=!1,console.log(t.response.data.message)})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),window.clearInterval(this.timer),this.time=60,this.buttonName="获取验证码",this.isDisabled=!1,this.form={pass:"",email:"",code:""}}}},l=(i("1B/D"),i("KHd+")),c=Object(l.a)(n,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{display:"inline-block"}},[i("el-dialog",{attrs:{visible:e.dialog,"close-on-click-modal":!1,title:e.title,"append-to-body":"",width:"475px"},on:{"update:visible":function(t){e.dialog=t},close:e.cancel}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"88px"}},[i("el-form-item",{attrs:{label:"新邮箱",prop:"email"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"on"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}}),e._v(" "),i("el-button",{attrs:{loading:e.codeLoading,disabled:e.isDisabled,size:"small"},on:{click:e.sendCode}},[e._v(e._s(e.buttonName))])],1),e._v(" "),i("el-form-item",{attrs:{label:"验证码",prop:"code"}},[i("el-input",{staticStyle:{width:"320px"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"当前密码",prop:"pass"}},[i("el-input",{staticStyle:{width:"320px"},attrs:{type:"password"},model:{value:e.form.pass,callback:function(t){e.$set(e.form,"pass",t)},expression:"form.pass"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)],1)},[],!1,null,"59e19c53",null);c.options.__file="updateEmail.vue";t.default=c.exports},"wk8/":function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return s}),i.d(t,"c",function(){return r}),i.d(t,"e",function(){return n}),i.d(t,"d",function(){return l});var o=i("t3Un");function a(e){return Object(o.a)({url:"api/users",method:"post",data:e})}function s(e){return Object(o.a)({url:"api/users/"+e,method:"delete"})}function r(e){return Object(o.a)({url:"api/users",method:"put",data:e})}function n(e){var t={oldPass:e.oldPass,newPass:e.newPass};return Object(o.a)({url:"api/users/updatePass/",method:"post",data:t})}function l(e,t){return Object(o.a)({url:"api/users/updateEmail/"+e,method:"post",data:t})}}}]);